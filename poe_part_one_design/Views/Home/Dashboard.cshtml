@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Dashboard";
    var role = HttpContextAccessor.HttpContext?.Session.GetString("Role");
    var email = HttpContextAccessor.HttpContext?.Session.GetString("Email");
    var firstName = HttpContextAccessor.HttpContext?.Session.GetString("FirstName");
    var surname = HttpContextAccessor.HttpContext?.Session.GetString("Surname");
}

<div class="dashboard-container">
    <div class="user-welcome">
        <h2>Welcome, <strong>@firstName @surname</strong>!</h2>
        <p>Email: @email</p>
        <div class="user-role @("role-" + role?.ToLower())">
            Role: @role
        </div>
    </div>

    <!-- Navigation -->
    <div class="dashboard-nav">
        @if (role == "Lecturer")
        {
            <a href="@Url.Action("LecturerPartial","Home")" class="nav-link">Submit Claim</a>
            <a href="@Url.Action("Track_Claim","Home")" class="nav-link">Track Claim</a>
        }
        else if (role == "Coordinator")
        {
            <a href="@Url.Action("LecturerPartial","Home")" class="nav-link">Submit Claim</a>
            <a href="@Url.Action("Track_Claim","Home")" class="nav-link">Track Claim</a>
            <a href="@Url.Action("CoordinatorPartial","Home")" class="nav-link">Verify Claims</a>
        }
        else if (role == "Manager")
        {
            <a href="@Url.Action("LecturerPartial","Home")" class="nav-link">Submit Claim</a>
            <a href="@Url.Action("Track_Claim","Home")" class="nav-link">Track Claim</a>
            <a href="@Url.Action("CoordinatorPartial","Home")" class="nav-link">Verify Claims</a>
            <a href="@Url.Action("ManagerPartial","Home")" class="nav-link">Approve Claims</a>
        }
        <a href="@Url.Action("Logout","Home")" class="nav-link" style="background:rgba(244,67,54,0.1);color:#c62828;border-color:rgba(244,67,54,0.2);">Logout</a>
    </div>

    <div id="partial-container" class="partial-container">
        <p style="text-align:center;color:#666;">Please select an option from the navigation above.</p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.nav-link');
        const partialContainer = document.getElementById('partial-container');

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();

                // Show loading state
                partialContainer.innerHTML = '<div style="text-align:center;padding:40px;"><div class="button-growth" style="justify-content:center;"><span class="growing-circle circle-1"></span><span class="growing-circle circle-2"></span><span class="growing-circle circle-3"></span></div><p>Loading...</p></div>';

                fetch(this.href)
                    .then(response => response.text())
                    .then(html => {
                        partialContainer.innerHTML = html;
                        // Re-initialize any interactive elements in the loaded partial
                        if (typeof initPasswordToggles === 'function') initPasswordToggles();
                        if (typeof initFormAnimations === 'function') initFormAnimations();
                    })
                    .catch(error => {
                        partialContainer.innerHTML = '<div style="color:red;text-align:center;padding:20px;">Error loading content. Please try again.</div>';
                    });
            });
        });
    });
</script>